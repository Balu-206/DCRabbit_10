/*** BeginHeader */
#ifndef __RCM40_58MHZ_IOCONFIG_LIB
#define __RCM40_58MHZ_IOCONFIG_LIB
/*** EndHeader */

/* START LIBRARY DESCRIPTION ************************************************
RCM40_58MHZ_IOCONFIG.LIB
DESCRIPTION:
 This library was generated by the Rabbit 4000 I/O LIB Utility.
 If it is modified in any incorrect way it might not load properly.
 Usage:
 #use "RCM40_58MHZ_IOCONFIG.LIB"
 main()
 {
    serDFconfig();
    ...
 }

SUPPORT LIBRARIES: none
END DESCRIPTION *************************************************************/

/*** BeginHeader  serDFconfig */
void serDFconfig();
void ClockCheck();
void SetupSerial();
#define DINBUFSIZE  127
#define DOUTBUFSIZE  127
#define SERD_TXPORT  PCDR
#define DDRIVE_TXD  0
#define SERD_RXPORT  PCDR
#define DDRIVE_RXD  1
#define FINBUFSIZE  127
#define FOUTBUFSIZE  127
#define SERF_TXPORT  PCDR
#define FDRIVE_TXD  2
#define SERF_RXPORT  PCDR
#define FDRIVE_RXD  3
/*** EndHeader */

/* START FUNCTION DESCRIPTION ***********************************************
serDFconfig                <RCM40_58MHZ_IOCONFIG.LIB>
void serDFconfig(void);

Configures serial ports D and F for use with RCM4000 series boards on RCM4000 
prototyping boards.

Serial port D is configured to use PC1 and PC0.

Serial port F is configured to use PC3 and PC2.
END DESCRIPTION *************************************************************/

void ClockCheck()
{
   if (freq_divider != 96) // 29.49 MHz, doubled
   {
      exception(-ERR_LIBCLOCKSPEED);
   }
}

void SetupSerial()
{
   serDopen(19200L);
   serDdmaOn(DMA_CHANNEL_ANY, DMA_CHANNEL_ANY);
   serFopen(19200L);
   serFdmaOn(DMA_CHANNEL_ANY, DMA_CHANNEL_ANY);
}

void serDFconfig()
{
   ClockCheck();
   // The following differ from BIOS settings
   SetupSerial();
   WrPortI(PCALR,&PCALRShadow,0x30);     // Serial Port F
   WrPortI(PCFR,&PCFRShadow,0xC5);     // Serial Port F
}

// The following are used by the configuration utility
// Restore(SDDLR, 0xBF)      // Serial Port D
// Restore(SFDLR, 0xBF)      // Serial Port F
// Restore(APID, 0x01)      // Serial Port D
// Restore(APIF, 0x01)      // Serial Port F
// Restore(DBL, 0x01)      // Processor Options
// Restore(DINBF, 0x7F)      // Serial Port D
// Restore(DOUTBF, 0x7F)      // Serial Port D
// Restore(FINBF, 0x7F)      // Serial Port F
// Restore(FOUTBF, 0x7F)      // Serial Port F
// Restore(SDDMA, 0x01)      // Serial Port D
// Restore(SFDMA, 0x01)      // Serial Port F
// Restore(USEPD, 0x01)      // Serial Port D
// Restore(USEPF, 0x01)      // Serial Port F

/*** BeginHeader */
#endif
/*** EndHeader */
//checksum:4372