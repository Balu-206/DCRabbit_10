/*** BeginHeader */
#ifndef __RCM42_29MHZ_IOCONFIG_LIB
#define __RCM42_29MHZ_IOCONFIG_LIB
/*** EndHeader */

/* START LIBRARY DESCRIPTION ************************************************
RCM42_29MHZ_IOCONFIG.LIB
DESCRIPTION:
 This library was generated by the Rabbit 4000 I/O LIB Utility.
 If it is modified in any incorrect way it might not load properly.
 Usage:
 #use "RCM42_29MHZ_IOCONFIG.LIB"
 main()
 {
    serDEconfig();
    ...
 }

SUPPORT LIBRARIES: none
END DESCRIPTION *************************************************************/

/*** BeginHeader  serDEconfig */
void serDEconfig();
void ClockCheck();
void SetupSerial();
#define DINBUFSIZE  127
#define DOUTBUFSIZE  127
#define SERD_TXPORT  PCDR
#define DDRIVE_TXD  0
#define SERD_RXPORT  PCDR
#define DDRIVE_RXD  1
#define EINBUFSIZE  127
#define EOUTBUFSIZE  127
#define SERE_TXPORT  PDDR
#define EDRIVE_TXD  6
#define SERE_RXPORT  PDDR
#define EDRIVE_RXD  7
/*** EndHeader */

/* START FUNCTION DESCRIPTION ***********************************************
serDEconfig                <RCM42_29MHZ_IOCONFIG.LIB>
void serDEconfig(void);

Configures serial ports D and E for use with RCM4210 boards on an RCM4200 
prototyping board.

Serial port D is configured to use PC1 and PC0.

Serial port E is configured to use PD7 and PD6.
END DESCRIPTION *************************************************************/

void ClockCheck()
{
   if (freq_divider != 48) // 29.49 MHz, not doubled
   {
      exception(-ERR_LIBCLOCKSPEED);
   }
}

void SetupSerial()
{
   serDopen(19200L);
   serDdmaOn(DMA_CHANNEL_ANY, DMA_CHANNEL_ANY);
   serEopen(19200L);
   WrPortI(SECR,&SECRShadow, 0x10);  
   serEdmaOn(DMA_CHANNEL_ANY, DMA_CHANNEL_ANY);
}

void serDEconfig()
{
   ClockCheck();
   // The following differ from BIOS settings
   SetupSerial();
   WrPortI(PCFR,&PCFRShadow,0x41);     // Serial Port D
   WrPortI(PDAHR,&PDAHRShadow,0x30);     // Serial Port E
   WrPortI(PDDDR,&PDDDRShadow,0x40);     // Serial Port E
   WrPortI(PDFR,&PDFRShadow,0x40);     // Serial Port E
}

// The following are used by the configuration utility
// Restore(SDDLR, 0x5F)      // Serial Port D
// Restore(SECR, 0x10)      // Serial Port E
// Restore(SEDLR, 0x5F)      // Serial Port E
// Restore(APID, 0x01)      // Serial Port D
// Restore(APIE, 0x01)      // Serial Port E
// Restore(DINBF, 0x7F)      // Serial Port D
// Restore(DOUTBF, 0x7F)      // Serial Port D
// Restore(EINBF, 0x7F)      // Serial Port E
// Restore(EOUTBF, 0x7F)      // Serial Port E
// Restore(SDDMA, 0x01)      // Serial Port D
// Restore(SEDMA, 0x01)      // Serial Port E
// Restore(USEPD, 0x01)      // Serial Port D
// Restore(USEPE, 0x01)      // Serial Port E

/*** BeginHeader */
#endif
/*** EndHeader */
//checksum:D8A3